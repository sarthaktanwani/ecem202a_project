#! /bin/bash
#add thing to get overall delay
ultimateStartTime=`date +%s.%3N`
source /opt/ros/melodic/setup.bash
start=`date +%s.%3N`
#sleep 1
STRING=$(rostopic echo /gazebo/model_states -n1 | grep -A3 -m2 "position" | tail -n3)
#STRING="x=45,y=45,z=0"
len=`expr length "$STRING"`
end=`date +%s.%3N`
runtime=$(bc -l <<<"${end}-${start}")
echo "The length of $STRING is $len"
echo "Start time is $start"
echo "End time is $end"
echo "Status Latency is $runtime"

NS3_PATH=~/Software/ns-allinone-3.30.1/ns-3.30.1

cd $NS3_PATH
export 'NS_LOG=UdpEchoClientApplication=level_all|prefix_func|prefix_time:UdpEchoServerApplication=level_all|prefix_func|prefix_time'
$NS3_PATH/waf --run "scratch/WiFi_simulation --nCsma=1 --nWifi=2 --dataLen=2044" > log.out 2>&1
s=$(grep -A1 "At time 4s" ./log.out | awk '{print $1;}')
#s=${s//[!0-9,.]/}
echo "start output"

echo "The two times are: $s"
startTime=$(echo $s | awk '{print $1;}')
startTime=${startTime//[!0-9,.]/}
echo "Start time is: $startTime"
stopTime=$(echo $s|awk '{print $2;}')
stopTime=${stopTime//[!0-9,.]/}
echo "Stop time is: $stopTime"
totalTime=$(bc -l <<<"${stopTime}-${startTime}")
echo "Total time is: $totalTime"
totalTime=$(bc -l <<<"${totalTime}*1000")
echo "Total time in ms is: $totalTime"
cd 

echo $pwd
#input="/home/pragyasharma/ECE202/ecem202a_project/software/demo.txt"

#while IFS= read -r line
#do
#  echo "$line"
#done < "$input"

sed  < "/home/pragyasharma/ECE202/ecem202a_project/software/demo.txt"

#to take arguments in a bash file
echo " I firmly believe that $1 is the best $2 for the office of $3"


echo $(whoami)

echo "What is your name?"
read name
if [ $name ]; then
	echo "$name sounds alright to me"
else
	echo "GIVE ME YOUR NAMEE!!!"
fi
